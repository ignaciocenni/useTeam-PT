{
  "name": "Kanban Export CSV",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "kanban-export",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "id": "d57f76bc-c149-442a-b9a6-1674fc6a72fc",
      "name": "Webhook",
      "webhookId": "b899fb55-2201-4558-8b3e-e7e6bb21e730"
    },
    {
      "parameters": {
        "jsCode": "// Extraer datos del webhook body\nconst body = $input.item.json.body || $input.item.json;\nconst email = body.email;\nconst boardData = body.boardData;\n\n// Validar que tengamos los datos necesarios\nif (!boardData || !boardData.data) {\n  console.log('Estructura recibida:', JSON.stringify($input.item.json, null, 2));\n  throw new Error('No se encontró boardData en el payload');\n}\n\nconsole.log('✅ Datos recibidos correctamente');\nconsole.log('Email:', email);\nconsole.log('Board Title:', boardData.boardTitle);\nconsole.log('Total Cards:', boardData.totalCards);\n\n// Generar encabezados CSV\nconst headers = 'ID,Título,Descripción,Columna,Fecha Creación,Posición\\n';\n\n// Generar filas CSV\nconst rows = boardData.data.map(card => {\n  const title = (card.title || '').replace(/\"/g, '\"\"');\n  const description = (card.description || '').replace(/\"/g, '\"\"');\n  const column = (card.column || '').replace(/\"/g, '\"\"');\n  \n  return `\"${card.id}\",\"${title}\",\"${description}\",\"${column}\",\"${card.createdAt}\",${card.position}`;\n}).join('\\n');\n\nconst csvContent = headers + rows;\n\nconsole.log('✅ CSV generado con', boardData.data.length, 'filas');\n\n// Retornar datos\nreturn [{\n  json: {\n    email: email,\n    boardTitle: boardData.boardTitle,\n    totalCards: boardData.totalCards,\n    exportedAt: boardData.exportedAt,\n    csvContent: csvContent\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        0
      ],
      "id": "f7a71128-5abb-4d9b-b55b-e1821c197dab",
      "name": "Code in JavaScript"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        []
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2d7dec77-97af-49d1-bc3c-2693ca8e9644",
  "meta": {
    "instanceId": "f1eb9ae025036b388005f531d294569cb0d92d1310d899ae0e364888b61fc9b4"
  },
  "id": "7Jnbs4WNhXZveSyt",
  "tags": []
}